{% extends 'layout.html.twig' %}

{% block content %}
<div class="container mt-5">
    <h1>Portail FHIR</h1>
    
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5>Patients</h5>
                    <p class="display-4" id="patient-count">-</p>
                </div>
            </div>
        </div>
        <!-- Autres cartes similaires -->
    </div>

    <div class="mt-5">
        <h2>Rechercher un patient</h2>
        <form id="search-form" class="row g-3">
            <div class="col-md-6">
                <input type="text" class="form-control" id="search-name" placeholder="Nom ou prénom">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary">Rechercher</button>
            </div>
        </form>
        
        <div id="search-results" class="mt-4"></div>
    </div>
</div>

<script>
// Charger les statistiques
fetch('/api/fhir/Patient?_count=0')
    .then(r => r.json())
    .then(data => {
        document.getElementById('patient-count').textContent = data.total || 0;
    });

// Recherche
document.getElementById('search-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('search-name').value;
    
    const response = await fetch(`/api/fhir/Patient?name=${encodeURIComponent(name)}`);
    const bundle = await response.json();
    
    const resultsDiv = document.getElementById('search-results');
    if (bundle.entry && bundle.entry.length > 0) {
        resultsDiv.innerHTML = bundle.entry.map(entry => `
            <div class="card mb-2">
                <div class="card-body">
                    <h5>${entry.resource.name[0].given[0]} ${entry.resource.name[0].family}</h5>
                    <p>ID: ${entry.resource.identifier[0].value}</p>
                    <a href="/fhir/patient/${entry.resource.id}" class="btn btn-sm btn-primary">Voir détails</a>
                </div>
            </div>
        `).join('');
    } else {
        resultsDiv.innerHTML = '<p>Aucun résultat trouvé</p>';
    }
});
</script>
{% endblock %}